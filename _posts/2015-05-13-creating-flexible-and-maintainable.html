---
layout: post
title: Creating a flexible and maintainable Xamarin.Forms app with Prism
date: '2015-05-13T15:21:00.000+01:00'
author: David Britch
tags:
- MVVM
- C#
- Prism
- Xamarin
modified_time: '2015-05-13T15:26:26.554+01:00'
thumbnail: http://lh3.googleusercontent.com/-_uB9mhBXxFY/VVNeEGD2K2I/AAAAAAAACrc/7C0fE2ESlWo/s72-c/image6.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-8265682915956744370.post-3884663684704785386
blogger_orig_url: https://dbritch.blogspot.com/2015/05/creating-flexible-and-maintainable.html
---

<p>Prism, a set of libraries developed by Microsoft, helps you to design and build apps using loosely-coupled components that can evolve independently but that can be easily integrated into the overall app. Prism now includes support for Xamarin.Forms in the form of a preview library. This library helps to produce Xamarin.Forms apps that are flexible, maintainable, and testable.</p> <p>Prism is designed to help developers create apps that need to accomplish the following:</p> <ul> <li>Address common app development scenarios.  <li>Separate the concerns of presentation, presentation logic, and model through support for the Model-View-ViewModel (MVVM) pattern.  <li>Use an architectural infrastructure to produce a consistent and high quality app.</li></ul> <p>The logical architecture of a typical Xamarin.Forms app that uses Prism is shown in the following diagram. Grey items are provided by Prism, with blues items having to be created by the developer.  <p><img title="image" style="border-left-width: 0px; border-right-width: 0px; background-image: none; border-bottom-width: 0px; float: none; padding-top: 0px; padding-left: 0px; margin-left: auto; display: block; padding-right: 0px; border-top-width: 0px; margin-right: auto" border="0" alt="image" src="http://lh3.googleusercontent.com/-_uB9mhBXxFY/VVNeEGD2K2I/AAAAAAAACrc/7C0fE2ESlWo/image6.png?imgmax=800" width="602" height="190"></p> <p>In this blog post I’ll take the sample app developed in my <a href="http://www.davidbritch.com/2015/05/creating-xamarinforms-app-that-uses.html">previous</a> blog post, and convert it to use Prism in order to further the separation of concerns in the sample app. I’ll assume that you are familiar with the <a href="http://go.microsoft.com/fwlink/p/?LinkID=290899">Unity</a> dependency injection container. However, you are not required to use Unity, or any other dependency injection container, in order to use Prism.</p> <h3>Implementation</h3> <p><strong>Bootstrapping the app</strong></p> <p>The <b>App</b> class, in the XamarinPhotoViewer project, has the responsibility for bootstrapping the app. </p> <div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:0ea6c16d-3bc2-499c-90c0-b9c3192fdeff" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre style=" width: 808px; height: 127px;background-color:White;overflow: visible;"><div><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #008080;">1</span> <span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> App : Application<br /></span><span style="color: #008080;">2</span> <span style="color: #000000;">{<br /></span><span style="color: #008080;">3</span> <span style="color: #000000;">   </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> App()<br /></span><span style="color: #008080;">4</span> <span style="color: #000000;">   {<br /></span><span style="color: #008080;">5</span> <span style="color: #000000;">      var bootstrapper </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> Bootstrapper();<br /></span><span style="color: #008080;">6</span> <span style="color: #000000;">      bootstrapper.Run(</span><span style="color: #0000FF;">this</span><span style="color: #000000;">);<br /></span><span style="color: #008080;">7</span> <span style="color: #000000;">   }<br /></span><span style="color: #008080;">8</span> <span style="color: #000000;">}</span></div></pre><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div><br /><p>This is achieved by using the <b>App</b> constructor to create an instance of the <b>Bootstrapper</b> class, and run it. The <b>Bootstrapper</b> class is simply a class that initializes the services that Prism will be using. </p><div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:cd71a6f4-e4a0-4753-8141-f1208442d14c" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre style=" width: 808px; height: 199px;background-color:White;overflow: visible;"><div><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #008080;"> 1</span> <span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> Bootstrapper : UnityBootstrapper<br /></span><span style="color: #008080;"> 2</span> <span style="color: #000000;">{<br /></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">   </span><span style="color: #0000FF;">protected</span><span style="color: #000000;"> </span><span style="color: #0000FF;">override</span><span style="color: #000000;"> Page CreateMainPage()<br /></span><span style="color: #008080;"> 4</span> <span style="color: #000000;">   {<br /></span><span style="color: #008080;"> 5</span> <span style="color: #000000;">      </span><span style="color: #0000FF;">return</span><span style="color: #000000;"> Container.Resolve</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">MainPage</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">();<br /></span><span style="color: #008080;"> 6</span> <span style="color: #000000;">   }<br /></span><span style="color: #008080;"> 7</span> <span style="color: #000000;"><br /></span><span style="color: #008080;"> 8</span> <span style="color: #000000;">   </span><span style="color: #0000FF;">protected</span><span style="color: #000000;"> </span><span style="color: #0000FF;">override</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> RegisterTypes()<br /></span><span style="color: #008080;"> 9</span> <span style="color: #000000;">   {<br /></span><span style="color: #008080;">10</span> <span style="color: #000000;">      Container.RegisterTypeForNavigation</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">PhotoPage</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">();<br /></span><span style="color: #008080;">11</span> <span style="color: #000000;">   }<br /></span><span style="color: #008080;">12</span> <span style="color: #000000;">}</span></div></pre><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div><br /><p>The <b>Bootstrapper</b> class derives from the <b>UnityBootstrapper</b> class, which is a Prism provided class that handles the initialization of the Unity container. The <b>Bootstrapper</b> class overrides the <b>CreateMainPage</b> method in order to return the page to be used as the root page of the app, and overrides the <b>RegisterTypes</b> method in order to register the <b>PhotoPage</b> view so that it can be used in navigation. <br /><p><strong>Connecting view models to views</strong></p><p>Prism provides a view model locator object that is responsible for the instantiation of view models and their association to views. This has the advantage that the app has a single class that is responsible for the instantiation of view models. <br /><p>The <b>ViewModelLocator</b> class has an attached property, <b>AutowireViewModel</b> that is used to associate view models with views. In the view’s XAML, this attached property is set to <b>true</b> to indicate that the view model should be automatically connected to the view. </p><div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:11d9cdf3-0a31-44e4-913b-36aa21d16f23" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre style=" width: 808px; height: 105px;background-color:White;overflow: visible;"><div><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #008080;">1</span> <span style="color: #0000FF;">&lt;</span><span style="color: #800000;">ContentPage </span><span style="color: #FF0000;">xmlns</span><span style="color: #0000FF;">=&quot;http://xamarin.com/schemas/2014/forms&quot;</span><span style="color: #FF0000;"><br /></span><span style="color: #008080;">2</span> <span style="color: #FF0000;">             xmlns:x</span><span style="color: #0000FF;">=&quot;http://schemas.microsoft.com/winfx/2009/xaml&quot;</span><span style="color: #FF0000;"><br /></span><span style="color: #008080;">3</span> <span style="color: #FF0000;">             xmlns:prism</span><span style="color: #0000FF;">=&quot;clr-namespace:Prism.Mvvm;assembly=Prism.Forms&quot;</span><span style="color: #FF0000;"><br /></span><span style="color: #008080;">4</span> <span style="color: #FF0000;">             prism:ViewModelLocator.AutowireViewModel</span><span style="color: #0000FF;">=&quot;true&quot;</span><span style="color: #FF0000;"><br /></span><span style="color: #008080;">5</span> <span style="color: #FF0000;">             x:Class</span><span style="color: #0000FF;">=&quot;XamarinPhotoViewer.Views.MainPage&quot;</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;"><br /></span><span style="color: #008080;">6</span> <span style="color: #000000;">  ...<br /></span><span style="color: #008080;">7</span> <span style="color: #000000;"></span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">ContentPage</span><span style="color: #0000FF;">&gt;</span></div></pre><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div><br /><p>The <b>ViewModelLocator </b>object uses a convention-based approach to locate and instantiate view models from views. This convention assumes that view models are in the same assembly as the view types, that view models are in a .ViewModels child namespace, that views are in a .Views child namespace, and that view model names correspond with view names and end with “ViewModel”. <br /><p><strong>Updating a view in response to changes in the view model</strong></p><p>All view model classes that are accessible to the view should implement the <b>INotifyPropertyChanged</b> interface. This allows view models to provide change notifications to any data-bound controls in the view when the underlying property value changes. However, this can be repetitive and error prone. Therefore, Prism provides the <b>BindableBase</b> class that implements the <b>INotifyPropertyChanged</b> interface. <br /><p>Each view model class in the sample app derives from the <b>BindableBase</b> class. Therefore, each view model class uses the <b>SetProperty</b> method in the <b>BindableBase</b> class to provide property change notification. </p><div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:a4ad7238-b001-4f67-a8f4-699a3d408651" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre style=" width: 808px; height: 177px;background-color:White;overflow: visible;"><div><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #008080;"> 1</span> <span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> PhotoPageViewModel : BindableBase, INavigationAware<br /></span><span style="color: #008080;"> 2</span> <span style="color: #000000;">{<br /></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">   ...<br /></span><span style="color: #008080;"> 4</span> <span style="color: #000000;">   </span><span style="color: #0000FF;">private</span><span style="color: #000000;"> </span><span style="color: #0000FF;">string</span><span style="color: #000000;"> _image;<br /></span><span style="color: #008080;"> 5</span> <span style="color: #000000;">   </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">string</span><span style="color: #000000;"> Image<br /></span><span style="color: #008080;"> 6</span> <span style="color: #000000;">   {<br /></span><span style="color: #008080;"> 7</span> <span style="color: #000000;">      </span><span style="color: #0000FF;">get</span><span style="color: #000000;"> { </span><span style="color: #0000FF;">return</span><span style="color: #000000;"> </span><span style="color: #0000FF;">this</span><span style="color: #000000;">._image; }<br /></span><span style="color: #008080;"> 8</span> <span style="color: #000000;">      </span><span style="color: #0000FF;">set</span><span style="color: #000000;"> { SetProperty(</span><span style="color: #0000FF;">ref</span><span style="color: #000000;"> </span><span style="color: #0000FF;">this</span><span style="color: #000000;">._image, value); }<br /></span><span style="color: #008080;"> 9</span> <span style="color: #000000;">   }<br /></span><span style="color: #008080;">10</span> <span style="color: #000000;">   ...<br /></span><span style="color: #008080;">11</span> <span style="color: #000000;">}</span></div></pre><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div><br /><p>The call to the <b>SetProperty</b> method simply updates the value of the property if it has changed, and provides property change notification to the view. <br /><p>For more information about data binding in Xamarin.Forms, see <a href="http://developer.xamarin.com/guides/cross-platform/xamarin-forms/xaml-for-xamarin-forms/data_binding_basics/">Data Binding Basics</a>. <br /><p><strong>Triggering actions in the view model from the view</strong></p><p>Apps typically invoke an action in response to a user action, such as a button click, that can be implemented by creating an event handler in the view’s code-behind file. However, in the MVVM pattern, the responsibility for implementing the action lies with the view model, and you should try to avoid placing code in the view’s code-behind file. <br /><p>Commands provide a convenient approach to represent actions that can be bound to controls in the view. View models typically expose command properties, for binding from the view, that are object instances that implement the <b>ICommand</b> interface. XAML inherently supports commands and many controls provide a <b>Command</b> property that can be data bound to an <b>ICommand</b> object in the view model. For more information about Xamarin.Forms support for <b>ICommand</b>, see <a href="http://developer.xamarin.com/guides/cross-platform/xamarin-forms/xaml-for-xamarin-forms/data_bindings_to_MVVM/">From Data Bindings to MVVM</a>. <br /><p>Prism provides the <b>DelegateCommand</b> class to implement commands in view models. </p><div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:63bb6a5e-c86b-442b-aca4-fe87f86518af" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre style=" width: 808px; height: 233px;background-color:White;overflow: visible;"><div><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #008080;"> 1</span> <span style="color: #0000FF;">public</span><span style="color: #000000;"> DelegateCommand NavigateCommand { </span><span style="color: #0000FF;">get</span><span style="color: #000000;">; </span><span style="color: #0000FF;">private</span><span style="color: #000000;"> </span><span style="color: #0000FF;">set</span><span style="color: #000000;">; }<br /></span><span style="color: #008080;"> 2</span> <span style="color: #000000;"><br /></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">...<br /></span><span style="color: #008080;"> 4</span> <span style="color: #000000;"><br /></span><span style="color: #008080;"> 5</span> <span style="color: #000000;"></span><span style="color: #0000FF;">public</span><span style="color: #000000;"> PhotoPageViewModel(INavigationService navigationService)<br /></span><span style="color: #008080;"> 6</span> <span style="color: #000000;">{<br /></span><span style="color: #008080;"> 7</span> <span style="color: #000000;">   ...<br /></span><span style="color: #008080;"> 8</span> <span style="color: #000000;">   </span><span style="color: #0000FF;">this</span><span style="color: #000000;">.NavigateCommand </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> DelegateCommand(GoBack);<br /></span><span style="color: #008080;"> 9</span> <span style="color: #000000;">}<br /></span><span style="color: #008080;">10</span> <span style="color: #000000;"><br /></span><span style="color: #008080;">11</span> <span style="color: #000000;"></span><span style="color: #0000FF;">private</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> GoBack()<br /></span><span style="color: #008080;">12</span> <span style="color: #000000;">{<br /></span><span style="color: #008080;">13</span> <span style="color: #000000;">   </span><span style="color: #0000FF;">this</span><span style="color: #000000;">.NavigationService.GoBack();<br /></span><span style="color: #008080;">14</span> <span style="color: #000000;">}</span></div></pre><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div><br /><p>The <b>NavigateCommand</b> is exposed to the view through a read-only property that’s initialized in the view model constructor.</p><div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:f2400d97-d273-4a86-8aa7-f1c5a6dc6b18" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre style=" width: 808px; height: 19px;background-color:White;overflow: visible;"><div><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #008080;">1</span> <span style="color: #0000FF;">&lt;</span><span style="color: #800000;">Button </span><span style="color: #FF0000;">Command</span><span style="color: #0000FF;">=&quot;</span><span style="color: #808000;">{Binding NavigateCommand}</span><span style="color: #0000FF;">&quot;</span><span style="color: #FF0000;"><br /></span><span style="color: #008080;">2</span> <span style="color: #FF0000;">        Text</span><span style="color: #0000FF;">=&quot;Go back&quot;</span><span style="color: #FF0000;"> </span><span style="color: #0000FF;">/&gt;</span></div></pre><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div><br /><p>When the command is invoked from the view, it simply forwards the call to the <b>GoBack</b> method in the view model class via the delegate specified in the view model constructor. <br /><p><strong>Navigating between pages</strong></p><p>The XamarinPhotoViewer sample app triggers navigation requests from user interaction in the views. These requests are to navigate between the <b>MainPage</b> and <b>PhotoPage</b> views. <br /><p>Prism’s <b>INavigationAware </b>interface allows an implementing view model class to participate in a navigation operation. This interface defines the <b>OnNavigatedFrom</b> and <b>OnNavigatedTo</b> methods that are called during a navigation operation. The <b>OnNavigatedFrom</b> method allows the page being navigated away from to perform any cleanup before it is disposed of. In the view model class for the page being navigated to, its <b>OnNavigatedTo</b> method is called after navigation is complete. The <b>OnNavigatedTo</b> method allows the newly displayed page to initialize itself by using any navigation parameters passed to it. For example, the <b>OnNavigatedTo</b> method in the <b>PhotoPageViewModel</b> class accepts a <b>Photo </b>parameter that is used to display data on the view. <br /><p>Prism provides the <b>PageNavigationService</b> class that allows view models to perform navigation operations without taking a dependency on UI types. When view model classes are instantiated, Unity will inject the dependencies that are required including the <b>PageNavigationService</b> instance. View models can then invoke the <b>Navigate</b> method on the <b>PageNavigationService</b> instance to cause the app to navigate to a particular view in the app, or the <b>GoBack</b> method to return to the previous view.</p><div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:9df29fa9-7680-44bb-a0bb-2dbd28c707bb" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre style=" width: 808px; height: 90px;background-color:White;overflow: visible;"><div><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #008080;">1</span> <span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> Navigate()<br /></span><span style="color: #008080;">2</span> <span style="color: #000000;">{<br /></span><span style="color: #008080;">3</span> <span style="color: #000000;">   var parameters </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> NavigationParameters();<br /></span><span style="color: #008080;">4</span> <span style="color: #000000;">   parameters.Add(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">photo</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">, </span><span style="color: #0000FF;">this</span><span style="color: #000000;">.Photo);<br /></span><span style="color: #008080;">5</span> <span style="color: #000000;">   </span><span style="color: #0000FF;">this</span><span style="color: #000000;">.NavigationService.Navigate(</span><span style="color: #800000;">&quot;</span><span style="color: #800000;">PhotoPage</span><span style="color: #800000;">&quot;</span><span style="color: #000000;">, parameters);<br /></span><span style="color: #008080;">6</span> <span style="color: #000000;">}</span></div></pre><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div><br /><p>The <b>Navigate</b> method accepts a string parameter that represents the page to be navigated to, and a navigation parameter that represents the data to pass to the page being navigated to. Any data being passed to the page being navigated to will be received by the <b>OnNavigatedTo</b> method of the view model class for the page type. <br /><p>Placing the navigation logic in view model classes enables navigation logic to be exercised through automated tests. In addition, view models can then implement logic to control navigation to ensure that any required business rules are enforced.</p><h3>Summary</h3><p>Prism for Xamarin.Forms provides loosely-coupled components that help you to produce Xamarin.Forms apps that are flexible, maintainable, and testable. In particular, Prism’s support for MVVM enables you to easily provide a clean separation of concerns between the appearance and layout of the UI from the responsibility for the business logic. This helps to ensure that an app will be easier to test, maintain, and evolve. <br /><p>The sample app can be downloaded <a href="http://1drv.ms/1G7WRp2">here</a>.</p>  