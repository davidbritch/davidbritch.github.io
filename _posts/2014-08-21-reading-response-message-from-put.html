---
layout: post
title: Reading the response message from a PUT request using PHP and cURL
date: '2014-08-21T11:04:00.001+01:00'
author: David Britch
tags:
- PHP
modified_time: '2014-08-21T11:09:54.445+01:00'
blogger_id: tag:blogger.com,1999:blog-8265682915956744370.post-7708482450734585183
blogger_orig_url: https://dbritch.blogspot.com/2014/08/reading-response-message-from-put.html
---

<p>Previously <a href="http://www.davidbritch.com/2014/08/test-post.html">Iâ€™ve mentioned that I had to write some PHP to PUT some JSON data to a RESTful web API.</a> After calling <strong>curl_exec()</strong> to make the PUT request I called <strong>curl_getInfo()</strong> to retrieve the HTTP status code from the response message, in order to output a success or failure message.</p> <p>While debugging this function it was sometimes necessary to examine the request message being sent to the web API, to ensure its format was correct. This required setting some additional CURLOPT parameters, as shown in the code below.</p> <div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:f9c5e93d-8cc5-48fa-9987-bc2900045dcd" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre style=" width: 808px; height: 367px;background-color:White;overflow: visible;"><div><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #008080;"> 1</span> <span style="color: #0000FF;">function</span><span style="color: #000000;"> callRestAPI(</span><span style="color: #800080;">$uri</span><span style="color: #000000;">,</span><span style="color: #000000;"> </span><span style="color: #800080;">$signature</span><span style="color: #000000;">,</span><span style="color: #000000;"> </span><span style="color: #800080;">$json</span><span style="color: #000000;">) {<br /></span><span style="color: #008080;"> 2</span> <span style="color: #000000;">    </span><span style="color: #800080;">$headers</span><span style="color: #000000;"> </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">array</span><span style="color: #000000;"> (<br /></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">        </span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Content-Type: application/json; charset=utf-8</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">,</span><span style="color: #000000;"><br /></span><span style="color: #008080;"> 4</span> <span style="color: #000000;">        </span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Content-Length: </span><span style="color: #000000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">.</span><span style="color: #008080;">strlen</span><span style="color: #000000;">(</span><span style="color: #800080;">$json</span><span style="color: #000000;">)</span><span style="color: #000000;">,</span><span style="color: #000000;"><br /></span><span style="color: #008080;"> 5</span> <span style="color: #000000;">        </span><span style="color: #000000;">&quot;</span><span style="color: #000000;">X-Signature: </span><span style="color: #000000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">.</span><span style="color: #000000;"> </span><span style="color: #800080;">$signature</span><span style="color: #000000;">    <br /></span><span style="color: #008080;"> 6</span> <span style="color: #000000;">    );<br /></span><span style="color: #008080;"> 7</span> <span style="color: #000000;">    <br /></span><span style="color: #008080;"> 8</span> <span style="color: #000000;">    </span><span style="color: #800080;">$channel</span><span style="color: #000000;"> </span><span style="color: #000000;">=</span><span style="color: #000000;"> curl_init(</span><span style="color: #800080;">$uri</span><span style="color: #000000;">);<br /></span><span style="color: #008080;"> 9</span> <span style="color: #000000;">    curl_setopt(</span><span style="color: #800080;">$channel</span><span style="color: #000000;">,</span><span style="color: #000000;"> CURLOPT_RETURNTRANSFER</span><span style="color: #000000;">,</span><span style="color: #000000;"> </span><span style="color: #0000FF;">true</span><span style="color: #000000;">);<br /></span><span style="color: #008080;">10</span> <span style="color: #000000;">    curl_setopt(</span><span style="color: #800080;">$channel</span><span style="color: #000000;">,</span><span style="color: #000000;"> CURLOPT_CUSTOMREQUEST</span><span style="color: #000000;">,</span><span style="color: #000000;"> </span><span style="color: #000000;">&quot;</span><span style="color: #000000;">PUT</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">);<br /></span><span style="color: #008080;">11</span> <span style="color: #000000;">    curl_setopt(</span><span style="color: #800080;">$channel</span><span style="color: #000000;">,</span><span style="color: #000000;"> CURLOPT_HTTPHEADER</span><span style="color: #000000;">,</span><span style="color: #000000;"> </span><span style="color: #800080;">$headers</span><span style="color: #000000;">);<br /></span><span style="color: #008080;">12</span> <span style="color: #000000;">    curl_setopt(</span><span style="color: #800080;">$channel</span><span style="color: #000000;">,</span><span style="color: #000000;"> CURLOPT_POSTFIELDS</span><span style="color: #000000;">,</span><span style="color: #000000;"> </span><span style="color: #800080;">$json</span><span style="color: #000000;">);<br /></span><span style="color: #008080;">13</span> <span style="color: #000000;">    curl_setopt(</span><span style="color: #800080;">$channel</span><span style="color: #000000;">,</span><span style="color: #000000;"> CURLOPT_SSL_VERIFYPEER</span><span style="color: #000000;">,</span><span style="color: #000000;"> </span><span style="color: #0000FF;">false</span><span style="color: #000000;">);<br /></span><span style="color: #008080;">14</span> <span style="color: #000000;">    curl_setopt(</span><span style="color: #800080;">$channel</span><span style="color: #000000;">,</span><span style="color: #000000;"> CURLOPT_CONNECTTIMEOUT</span><span style="color: #000000;">,</span><span style="color: #000000;"> </span><span style="color: #000000;">10</span><span style="color: #000000;">);<br /></span><span style="color: #008080;">15</span> <span style="color: #000000;">    curl_setopt(</span><span style="color: #800080;">$channel</span><span style="color: #000000;">,</span><span style="color: #000000;"> CURLOPT_VERBOSE</span><span style="color: #000000;">,</span><span style="color: #000000;"> </span><span style="color: #0000FF;">true</span><span style="color: #000000;">);<br /></span><span style="color: #008080;">16</span> <span style="color: #000000;">    curl_setopt(</span><span style="color: #800080;">$channel</span><span style="color: #000000;">,</span><span style="color: #000000;"> CURLOPT_HEADER</span><span style="color: #000000;">,</span><span style="color: #000000;"> </span><span style="color: #0000FF;">true</span><span style="color: #000000;">);<br /></span><span style="color: #008080;">17</span> <span style="color: #000000;">    curl_setopt(</span><span style="color: #800080;">$channel</span><span style="color: #000000;">,</span><span style="color: #000000;"> CURLINFO_HEADER_OUT</span><span style="color: #000000;">,</span><span style="color: #000000;"> </span><span style="color: #0000FF;">true</span><span style="color: #000000;">);<br /></span><span style="color: #008080;">18</span> <span style="color: #000000;">    <br /></span><span style="color: #008080;">19</span> <span style="color: #000000;">    </span><span style="color: #800080;">$response</span><span style="color: #000000;"> </span><span style="color: #000000;">=</span><span style="color: #000000;"> curl_exec(</span><span style="color: #800080;">$channel</span><span style="color: #000000;">);<br /></span><span style="color: #008080;">20</span> <span style="color: #000000;">    </span><span style="color: #800080;">$request</span><span style="color: #000000;"> </span><span style="color: #000000;">=</span><span style="color: #000000;"> curl_getInfo(</span><span style="color: #800080;">$channel</span><span style="color: #000000;">,</span><span style="color: #000000;"> CURLINFO_HEADER_OUT);<br /></span><span style="color: #008080;">21</span> <span style="color: #000000;">    </span><span style="color: #800080;">$statusCode</span><span style="color: #000000;"> </span><span style="color: #000000;">=</span><span style="color: #000000;"> curl_getInfo(</span><span style="color: #800080;">$channel</span><span style="color: #000000;">,</span><span style="color: #000000;"> CURLINFO_HTTP_CODE);<br /></span><span style="color: #008080;">22</span> <span style="color: #000000;"><br /></span><span style="color: #008080;">23</span> <span style="color: #000000;">    </span><span style="color: #0000FF;">echo</span><span style="color: #000000;"> </span><span style="color: #800080;">$request</span><span style="color: #000000;"> </span><span style="color: #000000;">.</span><span style="color: #000000;"> </span><span style="color: #000000;">&quot;</span><span style="color: #000000;">&lt;BR&gt;</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">;<br /></span><span style="color: #008080;">24</span> <span style="color: #000000;">    </span><span style="color: #0000FF;">echo</span><span style="color: #000000;"> </span><span style="color: #800080;">$response</span><span style="color: #000000;"> </span><span style="color: #000000;">.</span><span style="color: #000000;"> </span><span style="color: #000000;">&quot;</span><span style="color: #000000;">&lt;BR&gt;</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">;<br /></span><span style="color: #008080;">25</span> <span style="color: #000000;">    </span><span style="color: #0000FF;">echo</span><span style="color: #000000;"> </span><span style="color: #800080;">$statusCode</span><span style="color: #000000;"> </span><span style="color: #000000;">.</span><span style="color: #000000;"> </span><span style="color: #000000;">&quot;</span><span style="color: #000000;">&lt;BR&gt;</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">;    <br /></span><span style="color: #008080;">26</span> <span style="color: #000000;">    <br /></span><span style="color: #008080;">27</span> <span style="color: #000000;">    curl_close(</span><span style="color: #800080;">$channel</span><span style="color: #000000;">);    <br /></span><span style="color: #008080;">28</span> <span style="color: #000000;">    </span><span style="color: #0000FF;">return</span><span style="color: #000000;"> </span><span style="color: #800080;">$statusCode</span><span style="color: #000000;">;<br /></span><span style="color: #008080;">29</span> <span style="color: #000000;">}</span></div></pre><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div><br /><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>&nbsp;</p><p>The additions are to set:</p><ol><li><strong>CURLOPT_VERBOSE</strong> to <strong>true</strong> in order to output verbose information. <br /><li><strong>CURLOPT_HEADER</strong> to <strong>true</strong> to include the header in the output. <br /><li><strong>CURLINFO_HEADER_OUT</strong> to <strong>true</strong> to track the request message.</li></ol><p>Then, after executing the PUT request I called <a href="http://php.net/manual/en/function.curl-getinfo.php">curl_getInfo</a> to get information about the PUT request. Specifically I requested the request message string by&nbsp; using the <strong>CURLINFO_HEADER_OUT</strong> constant. This provides the request message which can then be output for debugging purposes.</p>  