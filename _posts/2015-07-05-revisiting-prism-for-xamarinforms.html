---
layout: post
title: Revisiting Prism for Xamarin.Forms
date: '2015-07-05T16:24:00.001+01:00'
author: David Britch
tags:
- ".NET"
- MVVM
- C#
- Prism
- Xamarin
modified_time: '2015-07-05T16:31:04.925+01:00'
blogger_id: tag:blogger.com,1999:blog-8265682915956744370.post-3182006376686390252
blogger_orig_url: https://dbritch.blogspot.com/2015/07/revisiting-prism-for-xamarinforms.html
---

<p><a href="http://www.davidbritch.com/2015/05/creating-flexible-and-maintainable.html">Previously</a> I wrote about how to create a flexible and maintainable Xamarin.Forms app with Prism. In the last month Prism for Xamarin.Forms has undergone some more work by <a href="http://brianlagunas.com/">Brian Lagunas</a>, and a couple of new features have been implemented. This blog post will investigate the new features provided by the latest release of Prism for Xamarin.Forms.</p> <h3>Navigation</h3> <p>There are two improvements made to navigation in the latest release of Prism for Xamarin.Forms. The first concerns how you register types for navigation, and how to perform navigation to registered types. An overload to <strong>IUnityContainer.RegisterTypeForNavigation</strong> has been added that accepts two generic types. The first argument is the View type, with the second argument being a Class type (most likely a ViewModel type).</p> <div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:a3c9e743-11f3-4d06-b8ba-72f516710e13" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre style=" width: 834px; height: 55px;background-color:White;overflow: visible;"><div><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #008080;">1</span> <span style="color: #0000FF;">protected</span><span style="color: #000000;"> </span><span style="color: #0000FF;">override</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> RegisterTypes()<br /></span><span style="color: #008080;">2</span> <span style="color: #000000;">{<br /></span><span style="color: #008080;">3</span> <span style="color: #000000;">    Container.RegisterTypeForNavigation</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">PhotoPage, PhotoPageViewModel</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">();<br /></span><span style="color: #008080;">4</span> <span style="color: #000000;">}</span></div></pre><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div><br /><p>A corresponding change has been made to <strong>INavigationService.Navigate</strong> method to accept a generic in place of a string to identify the View to navigate to.</p><div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:07fa10ff-cfc0-4dfd-946b-b89ead93daa5" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre style=" width: 834px; height: 63px;background-color:White;overflow: visible;"><div><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #008080;">1</span> <span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> Navigate()<br /></span><span style="color: #008080;">2</span> <span style="color: #000000;">{<br /></span><span style="color: #008080;">3</span> <span style="color: #000000;">    ...<br /></span><span style="color: #008080;">4</span> <span style="color: #000000;">    </span><span style="color: #0000FF;">this</span><span style="color: #000000;">.NavigationService.Navigate</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">PhotoPageViewModel</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">(parameters);<br /></span><span style="color: #008080;">5</span> <span style="color: #000000;">}</span></div></pre><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div></p><br /><p>The advantage of this approach is that it allows you specify a ViewModel for navigation, eliminating the magic string that was previously used.</p><p>The second improvement relates to how the correct <strong>INavigationService</strong> instance is obtained in a ViewModel for navigation. The previous approach involved having your ViewModel implement the <strong>INavigationServiceAware</strong> interface. in order to add a <strong>NavigationService</strong> instance to your ViewModel. In the latest release of Prism for Xamarin.Forms the <strong>INavigationService</strong> can be directly injected into the ViewModel constructor.</p><div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:3805661e-ddc7-41dd-aa73-870d6d61acc0" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre style=" width: 807px; height: 74px;background-color:White;overflow: visible;"><div><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #008080;">1</span> <span style="color: #0000FF;">public</span><span style="color: #000000;"> MainPageViewModel(INavigationService navigationService)<br /></span><span style="color: #008080;">2</span> <span style="color: #000000;">{<br /></span><span style="color: #008080;">3</span> <span style="color: #000000;">    </span><span style="color: #0000FF;">this</span><span style="color: #000000;">.NavigationService </span><span style="color: #000000;">=</span><span style="color: #000000;"> navigationService;<br /></span><span style="color: #008080;">4</span> <span style="color: #000000;">    ...<br /></span><span style="color: #008080;">5</span> <span style="color: #000000;">}</span></div></pre><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div><br /><p>Please note that in order for Prism to inject the proper<strong> INavigationService</strong> instance via the constructor, you must name the parameter <strong>navigationService</strong>. This is because each page in Xamarin.Forms has its own navigation instance. So Prism can’t just register a global navigation service for all pages. It has to have a navigation service specific to each page and ViewModel. Prism uses the Unity dependency injection container to resolve the service through constructor injection, and because Unity doesn’t allow you to look for a type Prism instead looks for a specific name, in this case <strong>navigationService</strong>.</p><h3>DependenyService improvements</h3><p>Xamarin.Forms provides the <a href="http://developer.xamarin.com/guides/cross-platform/xamarin-forms/dependency-service/">DependencyService</a> class to enable shared code to easily resolve interfaces to platform-specific implementations. However, it is not always easy to test ViewModels that make a call to the <strong>DependencyService</strong> class. A typical implementation without Prism is shown below.</p><div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:158d3ea3-eb6b-4029-8dcb-1887bbd73a89" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre style=" width: 807px; height: 157px;background-color:White;overflow: visible;"><div><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #008080;"> 1</span> <span style="color: #0000FF;">public</span><span style="color: #000000;"> MainPageViewModel()<br /></span><span style="color: #008080;"> 2</span> <span style="color: #000000;">{<br /></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">     _textToSpeech </span><span style="color: #000000;">=</span><span style="color: #000000;"> DependencyService.Get</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">ITextToSpeech</span><span style="color: #000000;">&gt;</span><span style="color: #000000;">();<br /></span><span style="color: #008080;"> 4</span> <span style="color: #000000;">     SpeakCommand </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> DelegateCommand(Speak);<br /></span><span style="color: #008080;"> 5</span> <span style="color: #000000;">}<br /></span><span style="color: #008080;"> 6</span> <span style="color: #000000;"><br /></span><span style="color: #008080;"> 7</span> <span style="color: #000000;"></span><span style="color: #0000FF;">private</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> Speak()<br /></span><span style="color: #008080;"> 8</span> <span style="color: #000000;">{<br /></span><span style="color: #008080;"> 9</span> <span style="color: #000000;">     _textToSpeech.Speak(TextToSay);<br /></span><span style="color: #008080;">10</span> <span style="color: #000000;">}</span></div></pre><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div><br /><p>Prism improves this experience by enabling you to ask for your dependency as an argument in your ViewModel constructor.</p><div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:5065211f-8a00-44dc-a2ea-e5c2795a2332" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre style=" width: 807px; height: 165px;background-color:White;overflow: visible;"><div><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #008080;"> 1</span> <span style="color: #0000FF;">public</span><span style="color: #000000;"> MainPageViewModel(ITextToSpeech textToSpeech)<br /></span><span style="color: #008080;"> 2</span> <span style="color: #000000;">{<br /></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">     _textToSpeech </span><span style="color: #000000;">=</span><span style="color: #000000;"> textToSpeech;<br /></span><span style="color: #008080;"> 4</span> <span style="color: #000000;">     SpeakCommand </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> DelegateCommand(Speak);<br /></span><span style="color: #008080;"> 5</span> <span style="color: #000000;">}<br /></span><span style="color: #008080;"> 6</span> <span style="color: #000000;"><br /></span><span style="color: #008080;"> 7</span> <span style="color: #000000;"></span><span style="color: #0000FF;">private</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> Speak()<br /></span><span style="color: #008080;"> 8</span> <span style="color: #000000;">{<br /></span><span style="color: #008080;"> 9</span> <span style="color: #000000;">     _textToSpeech.Speak(TextToSay);<br /></span><span style="color: #008080;">10</span> <span style="color: #000000;">}</span></div></pre><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div><p>The advantage of this approach is that it eliminates the call to the <strong>DependencyService</strong> class, helping to make your ViewModel class more easily testable. For an example that demonstrates using Prism with the TextToSpeech see <a href="https://github.com/PrismLibrary/Prism-Samples-Forms/tree/master/UsingDependencyService">this sample app</a>.</p><h3>Summary</h3><p>Prism for Xamarin.Forms provides loosely-coupled components that help you to produce Xamarin.Forms apps that are flexible, maintainable, and testable. The latest additions to Prism enhance the navigation experience and make it easier to test ViewModels that use the Xamarin.Forms <strong>DependencyService</strong> class.</p><p>The sample app can be downloaded <a href="http://1drv.ms/1TdZwkz">here</a>.</p>  