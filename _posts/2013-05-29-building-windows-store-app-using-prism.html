---
layout: post
title: Building a Windows Store app using Prism for the Windows Runtime
date: '2013-05-29T11:33:00.001+01:00'
author: David Britch
tags:
- MVVM
- C#
- Prism for the Windows Runtime
- Windows 8
- WinRT
- Windows Store app
modified_time: '2013-05-29T11:39:12.526+01:00'
blogger_id: tag:blogger.com,1999:blog-8265682915956744370.post-1352864287031733581
blogger_orig_url: https://dbritch.blogspot.com/2013/05/building-windows-store-app-using-prism.html
---

<p>I’ve had an article published on the <a href="http://blogs.msdn.com/b/ukmsdn/">MSDN UK Team Blog</a>, about <a href="http://blogs.msdn.com/b/ukmsdn/archive/2013/05/27/patterns-amp-practices-prism-for-the-windows-runtime.aspx">Building a Windows Store app using Prism for the Windows Runtime</a>. I’m reproducing the article on my blog as I’m going to build on it in a series of blog posts that will discuss different features of Prism.</p> <p>Many of you will be familiar with Prism, a <a href="http://pnp.azurewebsites.net/en-us/">patterns &amp; practices</a> release that helps you to design and build composite applications. For the past 6 months I've been working with <a href="http://pnp.azurewebsites.net/en-us/">patterns &amp; practices</a> on the next evolution of Prism known as Prism for the Windows Runtime.</p> <p>Prism for the Windows Runtime provides two libraries that help developers create managed Windows Store apps:</p> <ul> <li>The <a href="http://www.nuget.org/packages/Prism.StoreApps/">Microsoft.Practices.Prism.StoreApps</a> library provides support for bootstrapping MVVM apps, state management, validation of user input, navigation, data binding, commands, Flyouts, settings, and search.  <li>The <a href="https://www.nuget.org/packages/Prism.PubSubEvents/">Microsoft.Practices.Prism.PubSubEvents</a> Portable Class Library allows communication between loosely coupled components in an app, thus helping to reduce dependencies between assemblies in a Visual Studio solution.</li></ul> <p>Together the libraries accelerate development of apps by providing support for MVVM, loosely coupled communication, and the core services required in Windows Store apps.</p> <h3>Using Prism for the Windows Runtime</h3> <p>In order to demonstrate using Prism for the Windows Runtime, I've written a demo photo viewing app, which can be downloaded <a href="http://sdrv.ms/ZcC5QG">here</a>. In the app, there are two pages. The first page presents a thumbnail gallery view of photos in the users Pictures library. Clicking on a thumbnail takes the user to the second page which displays the full image. In the app, support for MVVM, navigation, and state management are all provided by Prism for the Windows Runtime.</p> <p>The first step in using Prism for the Windows Runtime is to add a reference to the <a href="http://www.nuget.org/packages/Prism.StoreApps/">Microsoft.Practices.Prism.StoreApps</a> library to your project, in order to use the services provided by the library. The <strong>MvvmAppBase</strong> class provides core startup behaviour for an MVVM app, with its constructor being the entry point for the app. Your <strong>App</strong> class should then derive from the <strong>MvvmAppBase</strong> class, and adds app specific startup behaviour.</p> <p>There are two view classes in the app, <strong>MainPage</strong> and <strong>PhotoPage</strong>, that bind to the <strong>MainPageViewModel</strong> and <strong>PhotoPageViewModel</strong> classes respectively. Each view class derives from the <strong>VisualStateAwarePage</strong> class, provided by the Prism.StoreApps library, that provides view management and navigation support. Each view model class derives from the <strong>ViewModel</strong> class, provided by the Prism.StoreApps library, that provides support for property change notification, navigation, and suspend/resume functionality. A static <strong>ViewModelLocator</strong> object, provided by the Prism.StoreApps library, is used to manage the instantiation of view models and their association to views.</p> <p>A required override in the <strong>App</strong> class is the <strong>OnLaunchApplication</strong> method, from where you will typically perform your initial navigation to a launch page.</p> <div style="border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: 'Courier New', courier, monospace; direction: ltr; max-height: 200px; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px" id="codeSnippetWrapper"> <div style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px" id="codeSnippet"><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px"><span style="color: #0000ff">protected</span> <span style="color: #0000ff">override</span> <span style="color: #0000ff">void</span> OnLaunchApplication(LaunchActivatedEventArgs args)</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">{</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">   NavigationService.Navigate(<span style="color: #006080">"Main"</span>, <span style="color: #0000ff">null</span>);</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">}</pre></div></div><p>This method uses the <strong>NavigationService</strong>, provided by the Prism.StoreApps library, to navigate to the <strong>MainPage</strong> in the app when it launches. "Main" is specified as the logical name of the view that will be navigated to. The default convention specified in the <strong>MvvmAppBase</strong> class is to append "Page" to the name and look for that page in a .Views child namespace in the project. Alternatively, another convention can be specified by overriding the <strong>GetPageType</strong> method in the <strong>MvvmAppBase</strong> class.</p><p>App specific initialization behaviour is specified in the <strong>OnInitialize</strong> method in the <strong>App</strong> class. In the case of the demo app this involves registering types and instances that will be used in the view model constructors with the <a href="http://unity.codeplex.com/">Unity</a> dependency injection container. However, Prism for the Windows Runtime is not dependent on <a href="http://unity.codeplex.com/">Unity</a>. Instead, you can register a factory with the <strong>ViewModelLocator</strong> object that will create a view model instance to be associated with a view. For more info see <a href="http://msdn.microsoft.com/en-us/library/windows/apps/xx130642.aspx">Using Prism for the Windows Runtime</a>.</p><div style="border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: 'Courier New', courier, monospace; direction: ltr; max-height: 200px; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px" id="codeSnippetWrapper"><div style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px" id="codeSnippet"><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px"><span style="color: #0000ff">protected</span> <span style="color: #0000ff">override</span> <span style="color: #0000ff">void</span> OnInitialize(IActivatedEventArgs args)</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">{</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">    _container.RegisterInstance&lt;INavigationService&gt;(NavigationService);</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">    _container.RegisterType&lt;IRepository, FileSystemRepository&gt;(<span style="color: #0000ff">new</span> ContainerControlledLifetimeManager());</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">}</pre><!--CRLF--></div></div><p>This method registers the <strong>NavigationService</strong> instance and <strong>FileSystemRepository</strong> type with the container, as singletons, based on their respective interfaces, so that the view model classes can take dependencies on them.</p><p>Because the demo app does use <a href="http://unity.codeplex.com/">Unity</a>, the <strong>Resolve</strong> method from the <strong>MvvmAppBase</strong> class is overridden in the <strong>App</strong> class to return a constructed view model instance.</p><div style="border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: 'Courier New', courier, monospace; direction: ltr; max-height: 200px; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px" id="codeSnippetWrapper"><div style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px" id="codeSnippet"><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px"><span style="color: #0000ff">protected</span> <span style="color: #0000ff">override</span> <span style="color: #0000ff">object</span> Resolve(Type type)</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">{</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">    <span style="color: #0000ff">return</span> _container.Resolve(type);</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">}</pre><!--CRLF--></div></div><p>This method override is used by the <strong>ViewModelLocator</strong> object to set a factory for the <strong>ViewModelLocator</strong> to use the container to construct view models so that their dependencies get injected by the container.</p><p>The <strong>ViewModelLocator</strong> object, provided by the Prism.StoreApps library, uses a convention-based approach to locate and instantiate view models from views. This convention assumes that view models are in the same assembly as the view types, that view models are in a .ViewModels child namespace, that views are in a .Views namespace, and that view model names correspond with view names and end with "ViewModel". The <strong>ViewModelLocator</strong> object has an attached property, <strong>AutoWireViewModel</strong>, which is used to manage the instantiation of view models and their association to views. In the view's XAML this attached property is set to true to indicate that the view model class should be automatically instantiated from the view class.</p><div style="border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: 'Courier New', courier, monospace; direction: ltr; max-height: 200px; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px" id="codeSnippetWrapper"><div style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px" id="codeSnippet"><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">prism:ViewModelLocator.AutoWireViewModel="true"</pre><!--CRLF--></div></div><p>The <strong>ViewModelLocator </strong>object uses the convention-based approach outlined earlier to resolve the correct view model type. The view model factory, set by the <strong>MvvmAppBase</strong> class, uses the dependency injection container to construct view model instances whose dependencies are injected by the container. When the view model instances are constructed, dependencies specified by the constructor parameters are resolved by the container and then passed into the view model. This is referred to as constructor injection. This approach removes the need for an object to locate its dependencies or manage their lifetimes, allows swapping of implemented dependencies without affecting the object, and facilitates testability by allowing dependencies to be mocked.</p><p>If you run the app and navigate to the <strong>PhotoPage</strong>, and then suspend and terminate the app, on activating the app again the previously loaded photo will be displayed. This is because the path to the photo is passed to <strong>PhotoPage</strong> as a navigation parameter, which is automatically serialized to disk by the Prism.StoreApps library when the app suspends. However, if you have any view model properties whose values you want to survive termination, you should annotate them with the <strong>[RestorableState]</strong> custom attribute. For more info see <a href="http://msdn.microsoft.com/en-us/library/windows/apps/xx130647.aspx">Handling suspend, resume, and activation</a>.</p><h3>Summary</h3><p>Prism for the Windows Runtime can accelerate the development of Windows Store apps by providing support for MVVM, loosely coupled communication, and the core services required in Windows Store apps. For a bigger app that demonstrates all of the features of Prism for the Windows Runtime see <a href="http://msdn.microsoft.com/en-us/library/windows/apps/xx130643.aspx">Developing a Windows Store business app using C#, XAML, and Prism for the Windows Runtime</a>.</p>  