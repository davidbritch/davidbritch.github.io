---
title: Suspend/resume/activation using Prism for the Windows Runtime
date: '2013-06-24T08:57:00.001+01:00'
author: David Britch
tags:
- MVVM
- C#
- Prism for the Windows Runtime
- Windows 8
- WinRT
- Windows Store app
modified_time: '2013-06-24T08:58:29.375+01:00'
blogger_id: tag:blogger.com,1999:blog-8265682915956744370.post-1678374968905419241
blogger_orig_url: https://dbritch.blogspot.com/2013/06/suspendresumeactivation-using-prism-for.html
---

<p><a href="http://www.davidbritch.com/2013/06/accessing-image-pixel-data-in-c-windows.html">Previously</a> I extended the sample photo viewing app so that the user can covert a colour photo to greyscale, on the <strong>PhotoPage</strong>. This used MVVM and commands to bind the <a href="http://msdn.microsoft.com/en-us/library/windows/apps/windows.ui.xaml.controls.primitives.buttonbase.command.aspx">Command</a> property of a <a href="http://msdn.microsoft.com/en-us/library/windows/apps/windows.ui.xaml.controls.checkbox">Checkbox</a> control to a <strong>DelegateCommand</strong> property on the <strong>PhotoPageViewModel</strong>. When the control’s command is invoked, the code in the view model is executed.</p> <p>In this blog post I’ll further extend the app so that page state can be serialized during suspension, and de-serialized when the app reactivates. Specifically, the <strong>IsGreyscale</strong> property of the <strong>PhotoPageViewModel</strong> class will be serialized/de-serialized so that when the app reactivates following termination, the state of the <a href="http://msdn.microsoft.com/en-us/library/windows/apps/windows.ui.xaml.controls.checkbox">Checkbox</a> control will be identical to when the app was suspended. <a href="http://msdn.microsoft.com/en-us/library/windows/apps/xx130643.aspx">Prism for the Windows Runtime</a> makes performing this task very straight forward.</p> <h3>Implementation</h3><h5>Suspend</h5><p>To have data survive the suspend/terminate cycle with Prism all you have to do is mark any properties whose data you want to survive termination with the custom <strong>[RestorableState]</strong> attribute.</p><div style="border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: 'Courier New', courier, monospace; direction: ltr; max-height: 200px; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px" id="codeSnippetWrapper"><div style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px" id="codeSnippet"><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">[RestorableState]</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px"><span style="color: #0000ff">public</span> <span style="color: #0000ff">bool</span> IsGreyscale { get; set; }</pre><!--CRLF--></div></div><p>When the the page is navigated away from the data contained in any properties marked with the custom <strong>[RestorableState]</strong> attribute is serialized to disk. All this work is performed by the <a href="http://www.nuget.org/packages/Prism.StoreApps/">Prism.StoreApps</a> library. For details of how Prism undertakes this operation see <a href="http://msdn.microsoft.com/en-us/library/windows/apps/xx130647.aspx">Handling suspend, resume, and activation in AdventureWorks Shopper</a>. </p><h5>Resume</h5><p>When an app resumes from suspension it continues from where it was when it was suspended, as the app is still stored in memory. Therefore, the sample app has no special behaviour associated with resuming from suspension. However, other apps may need to refresh content from network connections, the file system etc. For more information see <a href="http://msdn.microsoft.com/en-us/library/windows/apps/jj160316.aspx">Developing an end-to-end Windows Store app using C++ and XAML: Hilo</a>.</p><h5>Activation</h5><p>Windows may terminate an app after it has been suspended, if the system is low on resources. When a Prism app is reactivated, any properties that are marked with the custom <strong>[RestorableState]</strong> attribute, such as the <strong>IsGreyscale</strong> property in the sample app, will have their values restored from disk. All this work is performed by the <a href="http://www.nuget.org/packages/Prism.StoreApps/">Prism.StoreApps</a> library. For details of how Prism undertakes this operation see <a href="http://msdn.microsoft.com/en-us/library/windows/apps/xx130647.aspx">Handling suspend, resume, and activation in AdventureWorks Shopper</a>.</p><p>To ensure that a greyscale photo is shown on reactivation, provided that the <strong>IsGreyscale</strong> property is <strong>true</strong>, the <strong>OnNavigatedTo</strong> method in the <strong>PhotoPageViewModel</strong> class calls the <strong>ConvertPhotoToGreyscale</strong> method.</p><div style="border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: 'Courier New', courier, monospace; direction: ltr; max-height: 200px; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px" id="codeSnippetWrapper"><div style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px" id="codeSnippet"><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px"><span style="color: #0000ff">if</span> (IsGreyscale)</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">{</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">    ConvertPhotoToGreyscale();</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">}</pre><!--CRLF--></div></div><p>The overall effect of this is that if the user had the greyscale <a href="http://msdn.microsoft.com/en-us/library/windows/apps/windows.ui.xaml.controls.checkbox">Checkbox</a> control checked when the app suspended/terminated, the <a href="http://msdn.microsoft.com/en-us/library/windows/apps/windows.ui.xaml.controls.checkbox">Checkbox</a> control will be checked when the app reactivates, thus ensuring that the photo is displayed as greyscale rather than colour.</p><h3>Summary</h3><p>In this blog post I’ve further extended the sample PhotoViewer app so that along with frame state, page state can be serialized during suspension and de-serialized when the app reactivates following termination. This is achieved by marking properties whose values you want to survive termination with the custom <strong>[RestorableState]</strong> attribute.</p><p>The sample app can be downloaded <a href="http://sdrv.ms/19JEtCa">here</a>.</p>  