---
title: OAuth 2.0 for Native Apps using Xamarin.Forms
date: '2019-07-04T08:31:00.001+01:00'
author: David Britch
tags:
- C#
- Xamarin
modified_time: '2019-07-04T08:31:50.025+01:00'
blogger_id: tag:blogger.com,1999:blog-8265682915956744370.post-5416041300328804601
blogger_orig_url: https://dbritch.blogspot.com/2019/07/oauth-20-for-native-apps-using.html
---

<p>About two years ago I wrote some samples that demonstrate using Xamarin.Forms to implement OAuth 2.0 for Native Apps. This spec represents the best practices for OAuth 2.0 authentication flows from mobile apps. These include:</p><ul><li>Authentication requests should only be made through external user agents, such as the browser. This results in better security, and enables use of the user’s current authentication state, making single sign-on possible. Conversely, this means that authentication requests should never be made through a <strong>WebView</strong>. <strong>WebView</strong> controls are unsafe for third parties, as they leave the authorization grant and user’s credentials vulnerable to recording or malicious use. In addition, <strong>WebView</strong> controls don’t share authentication state, meaning single sign-on isn’t possible. </li><li>Native apps must request user authorization by creating a URI with the appropriate <a href="https://tools.ietf.org/html/rfc6749#section-4.1">grant types</a>. The app then redirects the user to this request URI. A redirect URI that the native app can receive and parse must also be supplied. </li><li>Native apps must use the Proof Key for Code Exchange (PKCE) protocol, to defend against apps on the same device potentially intercepting the authorization code.</li><li>Native apps should use the authorization code grant flow with PKCE. Conversely, native apps shouldn’t use the implicit grant flow.</li><li>Cross-Site Request Forgery (CSRF) attacks should be mitigated by using the<strong> state</strong> parameter to link requests and responses.</li></ul><p>More details can be found in the <a href="https://tools.ietf.org/html/rfc8252">OAuth 2.0 for Native Apps</a> spec. Ultimately though, it leads to the OAuth 2.0 authentication flow for native apps being:</p><ol><li>The native app opens a browser tab with the authorisation request.</li><li>The authorisation endpoint receives the authorisation request, authenticates the user, and obtains authorisation.</li><li>The authorisation server issues an authorization code to the redirect URI.</li><li>The native app receives the authorisation code from the redirect URI.</li><li>The native app presents presents the authorization code at the token endpoint.</li><li>The token endpoint validates the authorization code and issues the requested tokens.</li></ol><p>For a whole variety of reasons, the samples that demo this using Xamarin.Forms never saw the light of day, but they can now be found in my GitHub repo. There are two samples:</p><ul><li><a href="https://github.com/davidbritch/xamarin-forms/tree/master/NativeBrowsers">NativeBrowsers</a>. This sample demonstrates OAuth 2.0 for Native Apps in Xamarin.Forms without using any additional libraries,</li><li><a href="https://github.com/davidbritch/xamarin-forms/tree/master/NativeBrowsersWithOIDCClient">NativeBrowsersWithOidcClient</a>. This sample demonstrates OAuth 2.0 for Native Apps in Xamarin.Forms, and uses the <a href="https://github.com/IdentityModel/IdentityModel.OidcClient2">IdentityModel.OidcClient2</a> library. This library is OpenID certified, and I highly recommend it.</li></ul><p>Both samples consume endpoints on a publically available <a href="https://demo.identityserver.io">IdentityServer site</a>. The main things to note about the samples are that (1) they use custom URL schemes defined in the platform projects, and (2) each platform project has code to open/close the browser as required, which is invoked with the Xamarin.Forms <strong>DependencyService</strong>.</p><p>Hopefully the samples will be of use to people, and if you want to know how the code works you should thoroughly read the <a href="https://tools.ietf.org/html/rfc8252">OAuth 2.0 for Native Apps</a> spec.</p>