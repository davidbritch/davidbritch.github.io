---
layout: post
title: Changing the Default Conventions used in Prism for the Windows Runtime
date: '2013-06-10T14:32:00.000+01:00'
author: David Britch
tags:
- MVVM
- C#
- Prism for the Windows Runtime
- Windows 8
- WinRT
- Windows Store app
modified_time: '2013-06-10T14:34:46.502+01:00'
thumbnail: http://lh3.ggpht.com/-nVzwwJS23Ec/UbXVkQBA2iI/AAAAAAAACgw/OMu-RCpqe2w/s72-c/pages_thumb.png?imgmax=800
blogger_id: tag:blogger.com,1999:blog-8265682915956744370.post-7278952097075420524
blogger_orig_url: https://dbritch.blogspot.com/2013/06/changing-default-conventions-used-in.html
---

<p><a href="http://msdn.microsoft.com/en-us/library/windows/apps/xx130643.aspx">Prism for the Windows Runtime</a> specifies a <strong>ViewModelLocator</strong> object, that can be used to manage the instantiation of view models and their associations to views. This approach has the advantage that there’s a single class that’s responsible for view model instantiation.</p> <p>The <strong>ViewModelLocator</strong> class uses an attached property, <strong>AutoWireViewModel</strong>, to associate view models with views. In the view’s XAML this attached property is set to <strong>true</strong> to indicate that the view model should be automatically connected to the view. When the property is set to <strong>true</strong> the <strong>AutoWireViewModelChanged</strong> event handler (in the <strong>ViewModelLocator</strong> object) runs which first attempts to resolve the view model from any mappings that have been registered by the <strong>Register</strong> method of the <strong>ViewModelLocator</strong> object (for more info see my <a href="http://www.davidbritch.com/2013/06/building-windows-store-app-using-prism.html">previous</a> blog post). If the view model cannot be resolved using this approach, the method falls back to using a convention-based approach to resolve the correct view model type. This convention assumes that:</p> <ol> <li>View models are in the same assembly as the view types.  <li>Views are in a .Views child namespace.  <li>View names end with “Page”.  <li>View models are in a .ViewModels child namespace.  <li>View model names correspond with view names and end with “ViewModel”.</li></ol> <p>Using this convention, a view named <strong>MainPage</strong> must be located in a .Views child namespace, with its view model being named <strong>MainPageViewModel</strong>, which resides in a .ViewModels child namespace in the same assembly.</p> <p>However, Prism doesn’t force you to use this convention. If you wish to change it, you can. For instance, you may choose to have your view models in a separate assembly.</p> <h3>Overriding Prism’s Default Conventions</h3> <p>In order to demonstrate how to override Prism’s default conventions I’ve modified my sample PhotoViewer app so that both views and view models reside in the same Pages folder and .Pages child namespace.</p> <p><a href="http://lh4.ggpht.com/-jRymgu1J3do/UbXVjq9w1HI/AAAAAAAACgo/LVCUAfAvlMU/s1600-h/pages2.png"><img style="background-image: none; border-right-width: 0px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="pages" border="0" alt="pages" src="http://lh3.ggpht.com/-nVzwwJS23Ec/UbXVkQBA2iI/AAAAAAAACgw/OMu-RCpqe2w/pages_thumb.png?imgmax=800" width="214" height="94"></a></p> <p>Prism’s default convention specifies that Views can be located in a .Views child namespace. In order to override this convention the <strong>FrameNavigationService</strong> object must be configured to look for views in a location other than the Views folder. This can be achieved by overriding the <strong>GetPageType</strong> method (from the <strong>MvvmAppBase</strong> class) in the <strong>App</strong> class, and by adding code to define the page location and naming convention.</p> <div style="border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: 'Courier New', courier, monospace; direction: ltr; max-height: 200px; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px" id="codeSnippetWrapper"> <div style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px" id="codeSnippet"><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px"><span style="color: #0000ff">protected</span> <span style="color: #0000ff">override</span> Type GetPageType(<span style="color: #0000ff">string</span> pageToken)</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">{</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">    var assemblyQualifiedAppType = <span style="color: #0000ff">this</span>.GetType().GetTypeInfo().AssemblyQualifiedName;</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">    var pageNameWithParameter = assemblyQualifiedAppType.Replace(<span style="color: #0000ff">this</span>.GetType().FullName, <span style="color: #0000ff">this</span>.GetType().Namespace + <span style="color: #006080">".Pages.{0}Page"</span>);</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">    var viewFullName = <span style="color: #0000ff">string</span>.Format(CultureInfo.InvariantCulture, pageNameWithParameter, pageToken);</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">    var viewType = Type.GetType(viewFullName);</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">    <span style="color: #0000ff">return</span> viewType;</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">}</pre><!--CRLF--></div></div><p>This method simply redefines the convention for locating and naming views by specifying that they can be located in a .Pages child namespace, and that view names end with “Page”. If the app is run at this point the <strong>MainPage</strong> will be displayed, but it will be devoid of photo thumbnails because the <strong>MainPageViewModel</strong> will not be supplying any data to the view as it can’t be located.</p><p>To solve this problem the <strong>ViewModelLocator</strong> class must be configured to look for view models in a location other than the <strong>ViewModels</strong> folder in the same assembly. This can be achieved by overriding the <strong>OnInitialize</strong> method (from the <strong>MvvmAppBase</strong> class) in the <strong>App</strong> class, and invoking the static <strong>ViewModelLocator.SetDefaultViewTypeToViewModelTypeResolver</strong> method, passing in a delegate that specifies a view type and returns a corresponding view model type.</p><div style="border-bottom: silver 1px solid; text-align: left; border-left: silver 1px solid; padding-bottom: 4px; line-height: 12pt; background-color: #f4f4f4; margin: 20px 0px 10px; padding-left: 4px; width: 97.5%; padding-right: 4px; font-family: 'Courier New', courier, monospace; direction: ltr; max-height: 200px; font-size: 8pt; overflow: auto; border-top: silver 1px solid; cursor: text; border-right: silver 1px solid; padding-top: 4px" id="codeSnippetWrapper"><div style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px" id="codeSnippet"><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px"><span style="color: #0000ff">protected</span> <span style="color: #0000ff">override</span> <span style="color: #0000ff">void</span> OnInitialize(IActivatedEventArgs args)</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">{</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">    _container.RegisterInstance&lt;INavigationService&gt;(NavigationService);</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">    _container.RegisterType&lt;IRepository, FileSystemRepository&gt;(<span style="color: #0000ff">new</span> ContainerControlledLifetimeManager());</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">&nbsp;</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">    ViewModelLocator.SetDefaultViewTypeToViewModelTypeResolver((viewType) =&gt;</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">        {</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">            var viewModelTypeName = <span style="color: #0000ff">string</span>.Format(CultureInfo.InvariantCulture, <span style="color: #006080">"PhotoViewer.Pages.{0}ViewModel, PhotoViewer, Version=1.0.0.0, Culture=neutral, PublicKeyToken=495efabf0725380b"</span>, viewType.Name);</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">            var viewModelType = Type.GetType(viewModelTypeName);</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">            <span style="color: #0000ff">return</span> viewModelType;</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: white; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">        });</pre><!--CRLF--><pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; background-color: #f4f4f4; margin: 0em; border-left-style: none; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; border-right-style: none; font-size: 8pt; overflow: visible; padding-top: 0px">}</pre><!--CRLF--></div></div><p>As <a href="http://www.davidbritch.com/2013/05/building-windows-store-app-using-prism.html">previously</a> explained, the method first registers the <strong>NavigationService</strong> instance and <strong>FileSystemRepository</strong> type with the <a href="http://unity.codeplex.com/">Unity</a> container, so that the view model classes can take dependencies on them. The delegate passed into the <strong>SetDefaultViewTypeToViewModelTypeResolver </strong>method then simply redefines the convention for locating view models by specifying that they can be located in the PhotoViewer.Pages namespace, and that view model names end with “ViewModel”.</p><p>While the convention I’ve adopted here is not recommended, it does demonstrate how to override the default convention specified by Prism. For small apps the default convention will most likely suffice. However, for larger apps you may wish to move your view models into a separate assembly, such as a PCL.</p><h3>Summary</h3><p>You do not have to use the default conventions that are defined by Prism to locate and name views and views models. To change the convention for naming and locating views you can override the <strong>GetPageType</strong> method in your <strong>App</strong> class. To change the convention for naming, locating, and associating view models with views you should invoke the static <strong>ViewModelLocator.SetDefaultViewTypeToViewModelTypeResolver</strong> method, and pass in a delegate that specifies a view type and returns a corresponding view model type.</p><p>The sample app can be downloaded <a href="http://sdrv.ms/ZEJC8Z">here</a>.</p>  