---
layout: post
title: Creating a Xamarin.Forms app that uses the MVVM pattern
date: '2015-05-12T10:01:00.001+01:00'
author: David Britch
tags:
- MVVM
- C#
- Xamarin
modified_time: '2015-05-12T10:04:26.541+01:00'
blogger_id: tag:blogger.com,1999:blog-8265682915956744370.post-6587042320230088550
blogger_orig_url: https://dbritch.blogspot.com/2015/05/creating-xamarinforms-app-that-uses.html
---

<p>The MVVM pattern is well documented, and is used to cleanly separate the responsibility for the appearance and layout of the UI from the responsibility for the business logic.</p> <p>In this blog post I’ll explore using Xamarin.Forms and the MVVM pattern to create a simple photo viewer app. For more information about Xamarin.Forms and MVVM, see <a href="http://developer.xamarin.com/guides/cross-platform/xamarin-forms/xaml-for-xamarin-forms/data_bindings_to_MVVM/">From Data Bindings to MVVM</a>.</p> <h3>Implementation</h3> <p><strong>Bootstrapping the app</strong></p> <p>The <b>App</b> class, in the XamarinPhotoViewer project, has the responsibility for bootstrapping the app. </p> <div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:618a8a4e-a3a2-4030-8464-68e1b4c5ea0e" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre style=" width: 808px; height: 124px;background-color:White;overflow: visible;"><div><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #008080;">1</span> <span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> App : Application<br /></span><span style="color: #008080;">2</span> <span style="color: #000000;">{<br /></span><span style="color: #008080;">3</span> <span style="color: #000000;">   </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> App()<br /></span><span style="color: #008080;">4</span> <span style="color: #000000;">   {<br /></span><span style="color: #008080;">5</span> <span style="color: #000000;">      </span><span style="color: #008000;">//</span><span style="color: #008000;"> The root page of your application</span><span style="color: #008000;"><br /></span><span style="color: #008080;">6</span> <span style="color: #008000;"></span><span style="color: #000000;">      MainPage </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> MainPage();<br /></span><span style="color: #008080;">7</span> <span style="color: #000000;">   }<br /></span><span style="color: #008080;">8</span> <span style="color: #000000;">}</span></div></pre><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div><br /><p>This is achieved by using the <b>App</b> constructor to set the <b>MainPage</b> property to an instance of the page, in this case <b>MainPage</b>, to be displayed when the app starts. <br /><p><strong>Connecting view models to views</strong> <br /><p>The simplest approach for connecting a view model to a view is for the view to declaratively instantiate its corresponding view model in XAML. When the view is constructed, the corresponding view model object will also be constructed.</p><div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:1aa385af-6291-4fa2-ae10-24893098687a" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre style=" width: 808px; height: 166px;background-color:White;overflow: visible;"><div><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #008080;"> 1</span> <span style="color: #0000FF;">&lt;</span><span style="color: #800000;">ContentPage </span><span style="color: #FF0000;">xmlns</span><span style="color: #0000FF;">=&quot;http://xamarin.com/schemas/2014/forms&quot;</span><span style="color: #FF0000;"><br /></span><span style="color: #008080;"> 2</span> <span style="color: #FF0000;">             xmlns:x</span><span style="color: #0000FF;">=&quot;http://schemas.microsoft.com/winfx/2009/xaml&quot;</span><span style="color: #FF0000;"><br /></span><span style="color: #008080;"> 3</span> <span style="color: #FF0000;">             xmlns:viewmodels</span><span style="color: #0000FF;">=&quot;clr-namespace:XamarinPhotoViewer.ViewModels;<br /></span><span style="color: #008080;"> 4</span> <span style="color: #0000FF;">                               assembly=XamarinPhotoViewer&quot;</span><span style="color: #FF0000;"><br /></span><span style="color: #008080;"> 5</span> <span style="color: #FF0000;">             x:Class</span><span style="color: #0000FF;">=&quot;XamarinPhotoViewer.Views.MainPage&quot;</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;"><br /></span><span style="color: #008080;"> 6</span> <span style="color: #000000;">  </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">ContentPage.BindingContext</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;"><br /></span><span style="color: #008080;"> 7</span> <span style="color: #000000;">    </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">viewmodels:MainPageViewModel </span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;"><br /></span><span style="color: #008080;"> 8</span> <span style="color: #000000;">  </span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">ContentPage.BindingContext</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;"><br /></span><span style="color: #008080;"> 9</span> <span style="color: #000000;">  ...<br /></span><span style="color: #008080;">10</span> <span style="color: #000000;"></span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">ContentPage</span><span style="color: #0000FF;">&gt;</span></div></pre><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div><br /><p>When the <b>MainPage</b> view is created by the <b>App</b> class, an instance of the <b>MainPageViewModel</b> class is automatically constructed and set as the view’s <b>BindingContext</b>. This approach requires the view model class to have a parameterless constructor. <br /><p>An alternative approach is for the view to set its <b>BindingContext</b> in the code-behind file.</p><div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:2c64d439-e360-49e5-80a8-ac7871ca3715" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre style=" width: 808px; height: 129px;background-color:White;overflow: visible;"><div><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #008080;">1</span> <span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">partial</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> PhotoPage : ContentPage<br /></span><span style="color: #008080;">2</span> <span style="color: #000000;">{<br /></span><span style="color: #008080;">3</span> <span style="color: #000000;">   </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> PhotoPage(</span><span style="color: #0000FF;">object</span><span style="color: #000000;"> photo)<br /></span><span style="color: #008080;">4</span> <span style="color: #000000;">   {<br /></span><span style="color: #008080;">5</span> <span style="color: #000000;">      InitializeComponent();<br /></span><span style="color: #008080;">6</span> <span style="color: #000000;">      </span><span style="color: #0000FF;">this</span><span style="color: #000000;">.BindingContext </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">new</span><span style="color: #000000;"> PhotoPageViewModel(photo);<br /></span><span style="color: #008080;">7</span> <span style="color: #000000;">   }<br /></span><span style="color: #008080;">8</span> <span style="color: #000000;">}</span></div></pre><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div><br /><p>The programmatic construction and assignment of the view model within the view’s code-behind has the advantage that it allows parameters to be passed into view model constructors. <br /><p><strong>Displaying view model data on the view</strong> <br /><p>The <b>MainPage</b> class defines the XAML used to display a collection of photo thumbnails, in a <b>ListView</b> control.</p><div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:dd2d154b-c7d6-4c46-b8f3-96dee0db463b" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre style=" width: 808px; height: 233px;background-color:White;overflow: visible;"><div><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #008080;"> 1</span> <span style="color: #0000FF;">&lt;</span><span style="color: #800000;">StackLayout</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;"><br /></span><span style="color: #008080;"> 2</span> <span style="color: #000000;">   </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">Label </span><span style="color: #FF0000;">Text</span><span style="color: #0000FF;">=&quot;</span><span style="color: #808000;">{Binding PageTitle}</span><span style="color: #0000FF;">&quot;</span><span style="color: #FF0000;"><br /></span><span style="color: #008080;"> 3</span> <span style="color: #FF0000;">          HorizontalOptions</span><span style="color: #0000FF;">=&quot;Center&quot;</span><span style="color: #FF0000;"> </span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;"><br /></span><span style="color: #008080;"> 4</span> <span style="color: #000000;">   </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">ListView </span><span style="color: #FF0000;">x:Name</span><span style="color: #0000FF;">=&quot;PhotosListView&quot;</span><span style="color: #FF0000;"><br /></span><span style="color: #008080;"> 5</span> <span style="color: #FF0000;">             ItemsSource</span><span style="color: #0000FF;">=&quot;</span><span style="color: #808000;">{Binding Photos}</span><span style="color: #0000FF;">&quot;</span><span style="color: #FF0000;"><br /></span><span style="color: #008080;"> 6</span> <span style="color: #FF0000;">             ItemTapped</span><span style="color: #0000FF;">=&quot;OnItemTapped&quot;</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;"><br /></span><span style="color: #008080;"> 7</span> <span style="color: #000000;">      </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">ListView.ItemTemplate</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;"><br /></span><span style="color: #008080;"> 8</span> <span style="color: #000000;">        </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">DataTemplate</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;"><br /></span><span style="color: #008080;"> 9</span> <span style="color: #000000;">          </span><span style="color: #0000FF;">&lt;</span><span style="color: #800000;">ImageCell </span><span style="color: #FF0000;">ImageSource</span><span style="color: #0000FF;">=&quot;</span><span style="color: #808000;">{Binding Image}</span><span style="color: #0000FF;">&quot;</span><span style="color: #FF0000;"><br /></span><span style="color: #008080;">10</span> <span style="color: #FF0000;">                     Text</span><span style="color: #0000FF;">=&quot;</span><span style="color: #808000;">{Binding Name}</span><span style="color: #0000FF;">&quot;</span><span style="color: #FF0000;"> </span><span style="color: #0000FF;">/&gt;</span><span style="color: #000000;"><br /></span><span style="color: #008080;">11</span> <span style="color: #000000;">        </span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">DataTemplate</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;"><br /></span><span style="color: #008080;">12</span> <span style="color: #000000;">      </span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">ListView.ItemTemplate</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;"><br /></span><span style="color: #008080;">13</span> <span style="color: #000000;">   </span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">ListView</span><span style="color: #0000FF;">&gt;</span><span style="color: #000000;"><br /></span><span style="color: #008080;">14</span> <span style="color: #000000;"></span><span style="color: #0000FF;">&lt;/</span><span style="color: #800000;">StackLayout</span><span style="color: #0000FF;">&gt;</span></div></pre><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div><br /><p>The <b>ListView</b> control binds its <b>ItemsSource</b> property to the <b>Photos </b>property on the <b>MainPageViewModel</b> class, which contains a series of photos and corresponding data. Each <b>ListView</b> item is an <b>ImageCell</b> control that displays the photo thumbnail and the photo name. For more information about the <b>ListView</b> control, including controlling the appearance of each item of data displayed by the control, see <a href="http://developer.xamarin.com/guides/cross-platform/xamarin-forms/working-with/listview/">Working with ListView</a>. <br /><p><strong>Navigating between pages</strong> <br /><p>Xamarin.Forms provides a built-in navigation model that manages the navigation and user-experience of a stack of pages. This model implements a last-in, first-out stack of pages. For more information, see <a href="http://developer.xamarin.com/guides/cross-platform/xamarin-forms/introduction-to-xamarin-forms/#Navigation">Navigation</a>. <br /><p>The XamarinPhotoViewer sample app triggers navigation requests from user interaction in the views. These requests are to navigate between the <b>MainPage</b> and <b>PhotoPage</b> views. When the user taps a <b>ListView</b> item on the <b>MainPage</b>, the <b>PhotoPage</b> is navigated to where the tapped item is displayed along with additional data. The wiring of the <b>ItemTapped</b> event to the <b>OnItemTapped</b> event handler in the view’s code-behind occurs in the view’s XAML.</p><div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:4e592e1b-52b7-47b6-9e1b-88136b67d246" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre style=" width: 808px; height: 129px;background-color:White;overflow: visible;"><div><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #008080;">1</span> <span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> OnItemTapped(</span><span style="color: #0000FF;">object</span><span style="color: #000000;"> sender, ItemTappedEventArgs e)<br /></span><span style="color: #008080;">2</span> <span style="color: #000000;">{<br /></span><span style="color: #008080;">3</span> <span style="color: #000000;">   var photo </span><span style="color: #000000;">=</span><span style="color: #000000;"> e.Item;<br /></span><span style="color: #008080;">4</span> <span style="color: #000000;">   </span><span style="color: #0000FF;">if</span><span style="color: #000000;"> (photo </span><span style="color: #000000;">==</span><span style="color: #000000;"> </span><span style="color: #0000FF;">null</span><span style="color: #000000;">)<br /></span><span style="color: #008080;">5</span> <span style="color: #000000;">      </span><span style="color: #0000FF;">return</span><span style="color: #000000;">;<br /></span><span style="color: #008080;">6</span> <span style="color: #000000;"><br /></span><span style="color: #008080;">7</span> <span style="color: #000000;">   </span><span style="color: #0000FF;">this</span><span style="color: #000000;">.Navigation.PushAsync(</span><span style="color: #0000FF;">new</span><span style="color: #000000;"> PhotoPage(photo));<br /></span><span style="color: #008080;">8</span> <span style="color: #000000;">   </span><span style="color: #0000FF;">this</span><span style="color: #000000;">.PhotosListView.SelectedItem </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">null</span><span style="color: #000000;">;<br /></span><span style="color: #008080;">9</span> <span style="color: #000000;">}</span></div></pre><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div><br /><p>The <b>OnItemTapped</b> event handler retrieves the <b>ListView</b> item that was tapped on, and uses the <b>Navigation.PushAsync</b> method to open the <b>PhotoPage</b>, passing in the retrieved item which will be received by the <b>PhotoPage</b> view constructor and passed in turn into the <b>PhotoPageViewModel</b> constructor where it will be used to set view model properties that are bound to from the view. The event handler then resets the selected <b>ListView</b> item in preparation for navigation back to the <b>MainPage</b> view. <br /><p>On the <b>PhotoPage</b> view, a <b>Button</b> control is used to return to the <b>MainPage</b> view. This <b>Button</b> invokes the <b>OnBackButtonClicked</b> event handler.</p><div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:87c17819-925c-4664-b68e-0b92c0dd3a5e" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre style=" width: 808px; height: 56px;background-color:White;overflow: visible;"><div><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #008080;">1</span> <span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> OnBackButtonClicked(</span><span style="color: #0000FF;">object</span><span style="color: #000000;"> sender, EventArgs e)<br /></span><span style="color: #008080;">2</span> <span style="color: #000000;">{<br /></span><span style="color: #008080;">3</span> <span style="color: #000000;">   </span><span style="color: #0000FF;">this</span><span style="color: #000000;">.Navigation.PopAsync();<br /></span><span style="color: #008080;">4</span> <span style="color: #000000;">}</span></div></pre><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div><br /><p>This event handler uses the built-in back navigation provided by Xamarin.Forms to return to the previous page.</p><h3>Summary</h3><p>The MVVM pattern helps to cleanly separate the responsibility for the appearance and layout of the UI from the responsibility for the business logic. The main advantage of this approach is a reduction in the coupling between business logic and the UI which will make an app easier to test, maintain, and evolve. <br /><p>The sample app can be downloaded <a href="http://1drv.ms/1G7WP0m">here</a>. </p>  