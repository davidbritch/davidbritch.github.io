---
title: Accessing Image Pixel Data in a Xamarin.Forms App
date: '2015-11-30T13:40:00.001Z'
author: David Britch
tags:
- C#
- Xamarin
- pixel data
modified_time: '2015-11-30T13:48:36.265Z'
blogger_id: tag:blogger.com,1999:blog-8265682915956744370.post-4777077414371808530
blogger_orig_url: https://dbritch.blogspot.com/2015/11/accessing-image-pixel-data-in.html
---

<p>As a Xamarin employee, I spend a lot of my time writing code and content that ultimately ends up on the <a href="http://developer.xamarin.com">Xamarin Developer Center</a>. Because of this, it’s not often that I have things to say on this blog, as I’ve already said them in official Xamarin code/content. However, I’m working on a longer term project that won’t be published for a while, and it offers me the opportunity to share some early code, that’s often been requested by the community. Specifically, I’ve been working on accessing image pixel data from a Xamarin.Forms app, so that users will be able to perform image manipulation from Xamarin.Forms.</p> <p>The purpose of this blog post is to describe a basic architecture for accessing and manipulating pixel data from a Xamarin.Forms project. This will involve using the <a href="https://developer.xamarin.com/guides/cross-platform/xamarin-forms/dependency-service/">DependencyService</a> to execute platform-specific code to access and manipulate pixel data. However, the imaging operations can be defined in the Xamarin.Forms PCL project.</p> <p><strong>Disclaimer:</strong> This code featured here is alpha code, so all the usual caveats apply.</p> <h3>Implementation</h3> <p>In my Xamarin.Forms PCL project I’ve created the <strong>IBitmap</strong> interface, which defines the operations that must be implemented in each platform-specific project.</p> <div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:f0e2f751-3667-49bc-8287-c06250e555cf" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre style=" width: 814px; height: 161px;background-color:White;overflow: hidden;"><div><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #008080;">1</span> <span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">interface</span><span style="color: #000000;"> IBitmap</span><span style="color: #000000;">&lt;</span><span style="color: #000000;">T</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"><br /></span><span style="color: #008080;">2</span> <span style="color: #000000;">{<br /></span><span style="color: #008080;">3</span> <span style="color: #000000;">    </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> ToPixelArray ();<br /></span><span style="color: #008080;">4</span> <span style="color: #000000;"><br /></span><span style="color: #008080;">5</span> <span style="color: #000000;">    </span><span style="color: #0000FF;">void</span><span style="color: #000000;"> TransformImage (Func</span><span style="color: #000000;">&lt;</span><span style="color: #0000FF;">byte</span><span style="color: #000000;">, </span><span style="color: #0000FF;">byte</span><span style="color: #000000;">, </span><span style="color: #0000FF;">byte</span><span style="color: #000000;">, </span><span style="color: #0000FF;">double</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> pixelOperation);<br /></span><span style="color: #008080;">6</span> <span style="color: #000000;"><br /></span><span style="color: #008080;">7</span> <span style="color: #000000;">    T ToImage ();<br /></span><span style="color: #008080;">8</span> <span style="color: #000000;">}</span></div></pre><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div><p>The <strong>ToPixelArray</strong> method is used to convert the native image type to a <strong>byte</strong> array of raw pixel data. The <strong>TransformImage</strong> method is used to perform an imaging operation on the pixel data, such as convert to greyscale, convert to sepia, colour balance etc. The <strong>ToImage</strong> method is then used to convert the transformed pixel data back to the native image type. Eventually I expect there to be more operations specified in the <strong>IBitmap</strong> interface, including overloads of some of the existing operations.</p><p>The <strong>TransformImage</strong> method specifies a <strong>Func</strong> parameter. This <strong>Func</strong> will be used to perform per-pixel operations. For example, the <strong>ConvertToGreyscale</strong> <strong>Func</strong>, shown below, is used to convert an image to its greyscale representation:</p><div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:f3b0fc04-67f3-4428-9ae5-5dc7869afd25" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre style=" width: 800px; height: 90px;background-color:White;overflow: hidden;"><div><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #008080;">1</span> <span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">static</span><span style="color: #000000;"> </span><span style="color: #0000FF;">class</span><span style="color: #000000;"> ImagingOperations<br /></span><span style="color: #008080;">2</span> <span style="color: #000000;">{<br /></span><span style="color: #008080;">3</span> <span style="color: #000000;">    </span><span style="color: #0000FF;">public</span><span style="color: #000000;"> </span><span style="color: #0000FF;">static</span><span style="color: #000000;"> Func</span><span style="color: #000000;">&lt;</span><span style="color: #0000FF;">byte</span><span style="color: #000000;">, </span><span style="color: #0000FF;">byte</span><span style="color: #000000;">, </span><span style="color: #0000FF;">byte</span><span style="color: #000000;">, </span><span style="color: #0000FF;">double</span><span style="color: #000000;">&gt;</span><span style="color: #000000;"> ConvertToGreyscale </span><span style="color: #000000;">=</span><span style="color: #000000;"> (r, g, b) </span><span style="color: #000000;">=&gt;</span><span style="color: #000000;"> </span><span style="color: #800080;">0.299</span><span style="color: #000000;"> </span><span style="color: #000000;">*</span><span style="color: #000000;"> (r </span><span style="color: #000000;">-</span><span style="color: #000000;"> g) </span><span style="color: #000000;">+</span><span style="color: #000000;"> g </span><span style="color: #000000;">+</span><span style="color: #000000;"> </span><span style="color: #800080;">0.114</span><span style="color: #000000;"> </span><span style="color: #000000;">*</span><span style="color: #000000;"> (b </span><span style="color: #000000;">-</span><span style="color: #000000;"> g);<br /></span><span style="color: #008080;">4</span> <span style="color: #000000;">}</span></div></pre><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div><p>This <strong>Func</strong> will be passed from the Xamarin.Forms PCL project into the <strong>TransformImage</strong> implementation in each platform specific project, where it will be executed on each pixel in the image. The advantage of this approach is that any per-pixel imaging operations can all be defined once, in the Xamarin.Forms PCL project.</p><h3>Summary</h3><p>This blog post has described a basic architecture for accessing and manipulating pixel data from a Xamarin.Forms project. My next blog post will explain the implementation of the <strong>IBitmap</strong> interface in iOS.</p>  