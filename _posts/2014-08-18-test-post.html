---
layout: post
title: Making a PUT request using PHP and cURL
date: '2014-08-18T16:22:00.000+01:00'
author: David Britch
tags:
- PHP
modified_time: '2014-08-19T09:07:34.818+01:00'
blogger_id: tag:blogger.com,1999:blog-8265682915956744370.post-5112334965361221917
blogger_orig_url: https://dbritch.blogspot.com/2014/08/test-post.html
---

<p>I recently had to write some PHP to PUT some JSON data to a RESTful web API. My final solution involved reading numerous blog posts to piece together exactly what I needed. Bearing that in mind I decided to document my solution in case it’s useful to others, and for my own future use.</p> <p>The conventional technique for invoking a PUT operation is to set <strong>CURLOPT_PUT</strong> to <strong>true</strong>. However, this option is used to PUT a file, with the file to PUT being set with <strong>CURLOPT_INFILE</strong> and <strong>CURLOPT_INFILESIZE</strong>. Using this approach involves writing your JSON data to a file first, and removing the file after the operation. Aside from the inefficiency of this approach, functions such as <strong>tmpfile()</strong>, <strong>fwrite()</strong> and <strong>fseek()</strong> are not always supported in some environments.</p> <p>The standard solution is to set <strong>CURLOPT_CUSTOMREQUEST</strong> to “PUT” in order to specify the request type, and then set the <strong>CURLOPT_POSTFIELDS</strong> to the JSON data you want to PUT. In addition, you must set <strong>CURLOPT_RETURNTRANSFER</strong> to <strong>true</strong> in order to return the transfer value as a string, rather than it being output directly by <strong>curl_exec()</strong>.<strong> </strong>This is a well documented solution, most notably by <a href="http://www.lornajane.net/posts/2009/putting-data-fields-with-php-curl">LornaJane</a>.</p> <p>However, this solution needed extending in order to enable communication over SSL. In addition, I needed to append some custom header information to the request in order to support the authentication required by the web service. My solution is shown below.</p> <div id="scid:9D7513F9-C04C-4721-824A-2B34F0212519:3c2d3807-d2f4-4103-a936-af9dfc8580a4" class="wlWriterEditableSmartContent" style="float: none; padding-bottom: 0px; padding-top: 0px; padding-left: 0px; margin: 0px; display: inline; padding-right: 0px"><pre style=" width: 808px; height: 367px;background-color:White;overflow: auto;"><div><!--<br /><br />Code highlighting produced by Actipro CodeHighlighter (freeware)<br />http://www.CodeHighlighter.com/<br /><br />--><span style="color: #008080;"> 1</span> <span style="color: #0000FF;">function</span><span style="color: #000000;"> callRestAPI(</span><span style="color: #800080;">$uri</span><span style="color: #000000;">,</span><span style="color: #000000;"> </span><span style="color: #800080;">$signature</span><span style="color: #000000;">,</span><span style="color: #000000;"> </span><span style="color: #800080;">$json</span><span style="color: #000000;">) {<br /></span><span style="color: #008080;"> 2</span> <span style="color: #000000;">    </span><span style="color: #800080;">$headers</span><span style="color: #000000;"> </span><span style="color: #000000;">=</span><span style="color: #000000;"> </span><span style="color: #0000FF;">array</span><span style="color: #000000;"> (<br /></span><span style="color: #008080;"> 3</span> <span style="color: #000000;">        </span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Content-Type: application/json; charset=utf-8</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">,</span><span style="color: #000000;"><br /></span><span style="color: #008080;"> 4</span> <span style="color: #000000;">        </span><span style="color: #000000;">&quot;</span><span style="color: #000000;">Content-Length: </span><span style="color: #000000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">.</span><span style="color: #008080;">strlen</span><span style="color: #000000;">(</span><span style="color: #800080;">$json</span><span style="color: #000000;">)</span><span style="color: #000000;">,</span><span style="color: #000000;"><br /></span><span style="color: #008080;"> 5</span> <span style="color: #000000;">        </span><span style="color: #000000;">&quot;</span><span style="color: #000000;">X-Signature: </span><span style="color: #000000;">&quot;</span><span style="color: #000000;"> </span><span style="color: #000000;">.</span><span style="color: #000000;"> </span><span style="color: #800080;">$signature</span><span style="color: #000000;">    <br /></span><span style="color: #008080;"> 6</span> <span style="color: #000000;">    );<br /></span><span style="color: #008080;"> 7</span> <span style="color: #000000;">    <br /></span><span style="color: #008080;"> 8</span> <span style="color: #000000;">    </span><span style="color: #800080;">$channel</span><span style="color: #000000;"> </span><span style="color: #000000;">=</span><span style="color: #000000;"> curl_init(</span><span style="color: #800080;">$uri</span><span style="color: #000000;">);<br /></span><span style="color: #008080;"> 9</span> <span style="color: #000000;">    curl_setopt(</span><span style="color: #800080;">$channel</span><span style="color: #000000;">,</span><span style="color: #000000;"> CURLOPT_RETURNTRANSFER</span><span style="color: #000000;">,</span><span style="color: #000000;"> </span><span style="color: #0000FF;">true</span><span style="color: #000000;">);<br /></span><span style="color: #008080;">10</span> <span style="color: #000000;">    curl_setopt(</span><span style="color: #800080;">$channel</span><span style="color: #000000;">,</span><span style="color: #000000;"> CURLOPT_CUSTOMREQUEST</span><span style="color: #000000;">,</span><span style="color: #000000;"> </span><span style="color: #000000;">&quot;</span><span style="color: #000000;">PUT</span><span style="color: #000000;">&quot;</span><span style="color: #000000;">);<br /></span><span style="color: #008080;">11</span> <span style="color: #000000;">    curl_setopt(</span><span style="color: #800080;">$channel</span><span style="color: #000000;">,</span><span style="color: #000000;"> CURLOPT_HTTPHEADER</span><span style="color: #000000;">,</span><span style="color: #000000;"> </span><span style="color: #800080;">$headers</span><span style="color: #000000;">);<br /></span><span style="color: #008080;">12</span> <span style="color: #000000;">    curl_setopt(</span><span style="color: #800080;">$channel</span><span style="color: #000000;">,</span><span style="color: #000000;"> CURLOPT_POSTFIELDS</span><span style="color: #000000;">,</span><span style="color: #000000;"> </span><span style="color: #800080;">$json</span><span style="color: #000000;">);<br /></span><span style="color: #008080;">13</span> <span style="color: #000000;">    curl_setopt(</span><span style="color: #800080;">$channel</span><span style="color: #000000;">,</span><span style="color: #000000;"> CURLOPT_SSL_VERIFYPEER</span><span style="color: #000000;">,</span><span style="color: #000000;"> </span><span style="color: #0000FF;">false</span><span style="color: #000000;">);<br /></span><span style="color: #008080;">14</span> <span style="color: #000000;">    curl_setopt(</span><span style="color: #800080;">$channel</span><span style="color: #000000;">,</span><span style="color: #000000;"> CURLOPT_CONNECTTIMEOUT</span><span style="color: #000000;">,</span><span style="color: #000000;"> </span><span style="color: #000000;">10</span><span style="color: #000000;">);<br /></span><span style="color: #008080;">15</span> <span style="color: #000000;">    <br /></span><span style="color: #008080;">16</span> <span style="color: #000000;">    curl_exec(</span><span style="color: #800080;">$channel</span><span style="color: #000000;">);<br /></span><span style="color: #008080;">17</span> <span style="color: #000000;">    </span><span style="color: #800080;">$statusCode</span><span style="color: #000000;"> </span><span style="color: #000000;">=</span><span style="color: #000000;"> curl_getInfo(</span><span style="color: #800080;">$channel</span><span style="color: #000000;">,</span><span style="color: #000000;"> CURLINFO_HTTP_CODE);<br /></span><span style="color: #008080;">18</span> <span style="color: #000000;">    curl_close(</span><span style="color: #800080;">$channel</span><span style="color: #000000;">);    <br /></span><span style="color: #008080;">19</span> <span style="color: #000000;">    </span><span style="color: #0000FF;">return</span><span style="color: #000000;"> </span><span style="color: #800080;">$statusCode</span><span style="color: #000000;">;<br /></span><span style="color: #008080;">20</span> <span style="color: #000000;">}</span></div></pre><!-- Code inserted with Steve Dunn's Windows Live Writer Code Formatter Plugin.  http://dunnhq.com --></div><p>The important additions are that I set:</p><ol><li><strong>CURLOPT_SSL_VERIFYPEER</strong> to <strong>false</strong> to stop cURL from verifying the peer’s certificate, thus enabling communication over SSL. By default this value is <strong>true</strong>, and you are meant to set <strong>CURLOPT_CAINFO</strong> to specify the file holding the certificate to verify the peer with. I opted for stopping cURL from verifying the peer’s certificate in the interests of simplicity. <br /><li><strong>CURLOPT_HTTPHEADER</strong> to an array of HTTP header fields, containing the data required by the web service, including an authentication parameter.</li></ol><p>In addition, after executing the PUT request I called <a href="http://php.net/manual/en/function.curl-getinfo.php">curl_getInfo</a> to get information about the PUT request. Specifically I requested the status code of the operation using the <strong>CURLINFO_HTTP_CODE</strong> constant. This provides the HTTP status code contained within the response message, which is then returned to the calling function, so that an appropriate message can be output.</p>  